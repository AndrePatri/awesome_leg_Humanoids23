\section{Problem framing and state of the art}\label{sec:prb_def}
A jumping task may be split into four main phases (shown in Fig.~\ref{fig:pipeline}): the take-off or thrust, the flight, the impact and the braking. We start by exploring the phases individually and assess the challenges and peculiarities associated with each of them.

During the take-off phase the robot has to accelerate its center of mass (CoM) sufficiently to break the contact from the ground, while modulating the contact forces exchanged with the environment.
% During this phase, the highest amount of energy is drawn from the power source of the robot. 
% Most of the kinetic energy gained during the take-off phase is then converted into potential energy at the apex of the flight phase. 
% When the robot makes contact with the ground, it has already converted a big portion of its potential energy back into kinetic energy at the impact. 
% Based on its distribution among the joints and floating-base, the physical properties of the ground and of the robot's end-effector, part of the kinetic energy may be lost at the impact.
During the impact and the braking phase, an amount of the kinetic energy, on the basis of the properties of the colliding bodies (foot and ground) and the configuration of  the robot at the impact instant~\cite{impact_dyn::walker1994impact}, may be lost.
% For instance, if considering the specific case of our robot, it is clear that landing with a totally stretched leg on a rigid floor causes all the pre-impact energy to be dissipated through the mechanical structure of the robot, with no residual velocity at the joints after the touchdown.An amount of this kinetic energy, on the basis of the properties of the colliding impact surfaces and on the configuration assumed by the robot at the impact instant~\cite{impact_dyn::walker1990use,impact_dyn::walker1994impact,biomech::cui2021human,impact_dyn::rossi2015pre,impact_dyn::aouaj2021postimpact,impact_dyn::tassi2022impact}, may be lost during the transition from the impact and the braking phase.
% For instance, if considering the specific case of our robot, it is clear that landing with a totally stretched leg on a rigid floor causes all the pre-impact energy to be dissipated through the mechanical structure of the robot, with no residual velocity at the joints after the touchdown.
During the post-impact braking phase, any residual kinetic energy, if available, needs to be somehow dissipated in order to brake the robot. The question of whether this energy can be harvested or not, instead of being lost in the robot structure and the environment, rises.
% A pivotal aspect which has to be considered when designing and operating legged robot is autonomy: it is crucial for agile maneuvers, when necessary, to be performed with the highest possible efficiency. 
% As we have already highlighted, this principle plays an important role during the take-off, but it also does during the braking phase. 
Looking at nature, it has been highlighted how biological jumpers tend to employ energy storage principles during the landing phases to be able to increase the performance and efficiency of their movements~\cite{biomech::anderson1993storage,biomech::biewener1981elastic}. In the case of our prototype (powered by torque controlled actuators similar to those also used on CENTAURO~\cite{misc::kashiri2019centauro} robot), it is possible to exploit a similar strategy and make use of the power source in place of tendons as temporary energy storage of mechanical energy by performing what is called \textit{energy regeneration}~\cite{reg_braking::yoong2010studies,reg_braking::seok2014design} during braking phases.
% (when this is allowed, like in the case of batteries).
% There are instances of robots designed to mimic the energy storage approach of animals, e.g.~\cite{biomech::hyon2002development}. However, most of the modern robots are powered by electric Brushless Direct Current (BLDC) actuators, like in the case of our prototype.It is well known that it is possible to exploit the Pulse Width Modulation (PWM) power stage of such actuators to perform : by utilizing Field Oriented Control (FOC) it is theoretically possible to send back the negative mechanical energy at the joints during braking back to the power source. 
% In practice, however, there will always be an amount of (resistive) losses between the actuators' phases and the power source, which will inevitably reduce the quota of the recuperated energy. 
% These losses will depend on the amount of quadrature currents produced by the power stage. Intuitively, the faster the breaking is, the higher the torques needed at the link-side and, consequently, the higher the quadrature currents which need to be produced into the motor phases by the power stage. The higher the currents and the higher the ohmic losses inside the motor phases and inside the PWM stage are. 
% While lower braking phase velocities will produce lower regeneration currents and thus result to lower ohmic losses, higher braking phase velocities will produce higher regenerative mechanical energy. 

Based on these considerations, we choose to approach the problem of generating a jumping motion for our prototype in a modular way. Instead of solving a single optimization problem for the whole jump horizon, we split the problem into two separate ones (as shown in Fig.~\ref{fig:pipeline}) to gain simplicity both in terms of formulation and computational complexity. We tackle the take-off and flight phases (up to the apex) in the first one, with the objective of maximizing the apex height, while we address the remaining phases in the second. Given the characteristics of our experimental setup we don't add unnecessary complexity and employ a simple joint space impedance controller to track the references provided by our take-off TO. For the landing phase, we restrict our attention to a specific breaking strategy: after the apex, the joint level impedance controller is fed with desired landing impedance setpoints and a fixed reference configuration. The idea for the braking phase is to see if it's possible to optimize the impedance gains and configuration to maximize the recovered energy while also preventing high impacts.
% However, the two groups of phases $\{\text{take-off, flight}\}$ and $\{\text{impact, braking}\}$ cannot be independent and we hence need a way to couple them. We achieve this is a very straightforward way by employing the solution of the first and, in particular, the achieved tip jump height, to estimate the pre-impact velocity. The pre-impact velocity is then used as an input parameter for the braking TO.

%During the post-impact braking phase, any residual kinetic energy, if available, needs to be somehow dissipated in order to brake the robot. The question of whether this energy can be harnessed or not, instead of being lost in the robot structure and the environment, rises.
% A pivotal aspect which has to be considered when designing and operating legged robot is autonomy: it is crucial for agile maneuvers, when necessary, to be performed with the highest possible efficiency. 
% As we have already highlighted, this principle plays an important role during the take-off, but it also does during the braking phase. 
%Looking at nature, it has been highlighted how biological jumpers tend to employ energy storage principles during the landing phases to be able to increase the performance and efficiency of their movements~\cite{biomech::anderson1993storage,biomech::biewener1981elastic,biomech::biewener1998muscle,biomech::konow2012muscle}. In the case of our prototype (powered by the series elastic actuators also used on the CENTAURO~\cite{misc::kashiri2019centauro} robot), it is possible to exploit a similar strategy and make use of the power source in place of tendons as temporary energy storage of mechanical energy by performing what is called \textit{energy regeneration}~\cite{reg_braking::yoong2010studies,reg_braking::kivanc2016regenerative,reg_braking::riyadi2019analysis,reg_braking::seok2014design}.
% (when this is allowed, like in the case of batteries).
% There are instances of robots designed to mimic the energy storage approach of animals, e.g.~\cite{biomech::hyon2002development}. However, most of the modern robots are powered by electric Brushless Direct Current (BLDC) actuators, like in the case of our prototype.It is well known that it is possible to exploit the Pulse Width Modulation (PWM) power stage of such actuators to perform : by utilizing Field Oriented Control (FOC) it is theoretically possible to send back the negative mechanical energy at the joints during braking back to the power source. 
%In practice, however, there will always be an amount of (resistive) losses between the actuators' phases and the power source, which will inevitably reduce the quota of recoverable energy. 
% These losses will depend on the amount of quadrature currents produced by the power stage. Intuitively, the faster the breaking is, the higher the torques needed at the link-side and, consequently, the higher the quadrature currents which need to be produced into the motor phases by the power stage. The higher the currents and the higher the ohmic losses inside the motor phases and inside the PWM stage are.
%Consequently, the braking phase needs to be sufficiently slow to avoid large ohmic losses and hardware limits, but also fast enough to produce sufficient regenerative mechanical energy. 